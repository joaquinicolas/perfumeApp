{"version":3,"file":"main.js","sourceRoot":"","sources":["../main.ts"],"names":[],"mappings":"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","sourcesContent":["import 'reflect-metadata';\nimport {app, BrowserWindow, ipcMain, dialog} from 'electron';\nimport * as url from 'url';\nimport * as path from 'path';\nimport {API} from './api';\nimport * as fs from 'fs';\nimport * as Datastore from 'nedb';\nimport {Spreadsheet} from './excel';\n\nexport enum AppEvents {\n  ReadCommodities = 'getCommodities',\n  SaveCommodity = 'saveCommodity',\n  ReadFragancias = 'getFragancias',\n  SaveFragancias = 'saveChanges',\n  CommodityById = 'commodityById',\n  UploadFile = 'uploadFile',\n}\n\nexport enum FileStatus {\n  Ok,\n  Error,\n}\n\nenum FileStatusMessages {\n  Ok = 'Materias primas almacenadas exitosamente',\n  Error = 'Material primas no pudieron ser almacenadas'\n}\n\nconst fraganciasFolder = 'fragancias';\nlet dbPath = path.resolve(userHome(), fraganciasFolder);\nlet win: BrowserWindow;\n\nfunction createWindow() {\n  win = new BrowserWindow({\n    width: 600,\n    height: 600,\n    backgroundColor: '#ffffff',\n    webPreferences: {\n      nodeIntegration: true,\n    },\n  });\n\n  win.loadURL(\n    url.format({\n      pathname: path.resolve(__dirname, '../../dist/index.html'),\n      protocol: 'file:',\n      slashes: true,\n    })\n  );\n\n  win.on('closed', () => {\n    win = null;\n  });\n}\n\napp.on('ready', createWindow);\napp.on('window-all-closed', () => {\n  if (process.platform !== 'darwin') {\n    app.quit();\n  }\n});\napp.on('activate', () => {\n  if (win === null) {\n    createWindow();\n  }\n});\n\nipcMain.on(AppEvents.UploadFile, async (event: any) => {\n  const res = await dialog.showOpenDialog(win, {\n    properties: ['openFile'],\n    filters: [{name: 'Custom File Type', extensions: ['xlsx', 'xls']}],\n  });\n\n  if (res.canceled) {\n    win.webContents.send(AppEvents.UploadFile, '');\n  } else {\n    try {\n      const store = new Store();\n      const api = new API(store);\n      const spreadsheetAPI = new Spreadsheet();\n      spreadsheetAPI.readCommoditiesFile(res.filePaths[0]).subscribe(\n        (val) => api.saveCommodity(val),\n        (err) => {\n          showErrorDialog(err);\n          win.webContents.send(AppEvents.UploadFile, FileStatus.Error);\n        },\n        () => {\n          showMessageBox(FileStatusMessages.Ok);\n          win.webContents.send(AppEvents.UploadFile, FileStatus.Ok)\n        }\n      );\n    } catch (err) {\n      showErrorDialog(err);\n      win.webContents.send(AppEvents.UploadFile, FileStatus.Error);\n    }\n  }\n});\nipcMain.on(AppEvents.ReadFragancias, async () => {\n  const store = new Store();\n  const api = new API(store);\n  try {\n    let fragancias = await api.getFragancias();\n    win.webContents.send(AppEvents.ReadFragancias, fragancias);\n  } catch (error) {\n    showErrorDialog(error);\n  }\n});\n\nipcMain.on(AppEvents.SaveFragancias, async (event, args) => {\n  const api = new API(new Store());\n  try {\n    let newFrag = await api.saveFragancia(args);\n    showMessageBox('Fragancia almacenada exitosamente');\n    win.webContents.send(AppEvents.SaveFragancias);\n  } catch (e) {\n    showErrorDialog(e);\n  }\n});\n\nipcMain.on(AppEvents.ReadCommodities, async (event, args) => {\n  const api = new API(new Store());\n  try {\n    let commodities = await api.getCommodities();\n    win.webContents.send(AppEvents.ReadCommodities, commodities);\n  } catch (e) {\n    showErrorDialog(e);\n  }\n});\n\nipcMain.on(AppEvents.SaveCommodity, async (event, args) => {\n  const api = new API(new Store());\n  try {\n    let newComm = await api.saveCommodity(args);\n    win.webContents.send(AppEvents.SaveCommodity, newComm);\n  } catch (e) {\n    showErrorDialog(e);\n  }\n});\n\nipcMain.on(AppEvents.CommodityById, async (event, args) => {\n  const api = new API(new Store());\n  try {\n    api\n      .CommodityById(args)\n      .subscribe((x) => win.webContents.send(AppEvents.CommodityById, x));\n  } catch (e) {\n    showErrorDialog(e);\n  }\n});\n\nexport class Store {\n  db: {\n    fragancias: Nedb<any>;\n    commodities: Nedb<any>;\n  };\n  static instance: Store;\n\n  constructor() {\n    if (typeof Store.instance === 'object') {\n      return Store.instance;\n    }\n\n    try {\n      if (!fs.existsSync(dbPath)) {\n        fs.mkdirSync(dbPath);\n      }\n      this.db = {\n        fragancias: new Datastore(path.resolve(dbPath, 'fragancias.db')),\n        commodities: new Datastore(path.resolve(dbPath, 'commodities.db')),\n      };\n      this.db.fragancias.loadDatabase();\n      this.db.commodities.loadDatabase();\n    } catch (error) {\n      showErrorDialog(error);\n      throw error;\n    }\n    Store.instance = this;\n    return this;\n  }\n}\n\nfunction showErrorDialog(msg: string) {\n  const title = 'Ocurrio un error';\n  return dialog.showErrorBox(title, msg.toString());\n}\n\nfunction showMessageBox(message: string): Promise<Electron.MessageBoxReturnValue> {\n  const title = 'Accion exitosa';\n  const type = 'info';\n  const buttons = ['Entiendo'];\n\n  return dialog.showMessageBox(win, {\n    title,\n    message,\n    type,\n    buttons,\n  });\n}\n\nfunction userHome(): string {\n  const linuxHome = 'HOME';\n  const win32Home = 'USERPROFILE';\n  return process.env[process.platform == 'win32' ? win32Home : linuxHome];\n}\n"]}